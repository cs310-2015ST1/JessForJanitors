<!DOCTYPE html>

{% load staticfiles %} <!-- New line -->



<html>
    <head>
        <link href="{% static 'css/bootstrap-fluid-adj.css'%} " rel="stylesheet">
        <link href="{% static 'css/bootstrap.min.css'%} " rel="stylesheet" media="screen">
        <link href="{% static 'css/bootstrap-responsive.css' %}" rel="stylesheet">
        <link href="{% static 'css/artly-css.css' %}" rel="stylesheet">
        <script src="{% static 'js/jquery-2.1.4.min.js' %}"></script>
        <script src="{% static 'js/artly-ajax.js' %}"></script>
        <!--<script src="{% static 'js/artly-jquery.js' %}"></script>-->
        <!--<link rel="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css"></link>-->
        <script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>

        <title>Artly</title>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript"
     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnfkZ8FnyCfBkLpC6qCPEZpe_wLpT1lmE&sensor=false">
    </script>
    <script type="text/javascript">
      var map;

      function plotPosition(position) {
    	userPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var mapOptions = {
          center: userPosition,
          zoom: 12
        };
		var radius = 2000.0;

		// var radius = document.getElementById("radiusMenuOption").value;
        // http://www.geodatasource.com/developers/javascript
        function distance(lat1, lon1, lat2, lon2) {
			var radlat1 = Math.PI * lat1/180
			var radlat2 = Math.PI * lat2/180
			var radlon1 = Math.PI * lon1/180
			var radlon2 = Math.PI * lon2/180
			var theta = lon1-lon2
			var radtheta = Math.PI * theta/180
			var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
			dist = Math.acos(dist)
			dist = dist * 180/Math.PI
			dist = dist * 60 * 1.1515
			dist = dist * 1.609344
			return dist * 1000
        }
        {% for artinstallation in artinstallations %}
        var distan = distance(position.coords.latitude, position.coords.longitude, {{artinstallation.lat}}, {{artinstallation.lon}})
        //window.alert(distance(position.coords.latitude, position.coords.longitude, {{artinstallation.lat}}, {{artinstallation.lon}}));
        var distan_round = Math.round(distan);
        $(".distance-{{artinstallation.locationid}}").html(distan_round);
        if (distan > radius) {
            $('.{{artinstallation.locationid}}').hide();
        }
        else if (distan <= radius) {
            $('.{{artinstallation.locationid}}').show();
        }
        {% endfor %}

        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
        var center = new google.maps.Circle({
          strokeColor: '#7E5CD6',
          strokeOpacity: 0.4,
          fillColor: '#7E5CD6',
          fillOpacity: 0.3,
          map: map,
          center: map.getCenter(),
          radius: radius,
        })
        {% for artinstallation in artinstallations %}
        var marker = new google.maps.Marker({
          position: {lat: {{artinstallation.lat}}, lng: {{artinstallation.lon}}},
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 3,
            strokeColor: "#4884AB"
          },
          map: map
        })
        {% endfor %}
	  }
      function initialize() {
        if (navigator.geolocation) {
        	navigator.geolocation.getCurrentPosition(plotPosition);
   		} else {
   			window.alert("Geolocation is not supported by this browser.");
		}
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    </head>
    <body>

    <script type="text/javascript">
    function changeRadius() {
      	var radius = document.getElementById("radius-menu-option").value;
      }
    </script>

        <div class="container">
            <h1>Artly</h1>
            <h4>explore Vancouver through public art</h4><br />
			<div id="radius-dropdown">
            Radius:
            <select name="radiusMenuOption" id="radiusMenuOption" onchange="initialize()">
        		<option value="1000.0">1 km</option>
        		<option value="2000.0" selected>2 km</option>
        		<option value="3000.0">3 km</option>
        		<option value="4000.0">4 km</option>
        		<option value="5000.0">5 km</option>
        	</select>
        	</div>
            
            {% if artinstallations %}

            <div id="content">
            <div id="map-canvas"></div>
            <div id="butt">
            <button onclick='$("#example").dataTable( {"paging": false, "scrollY": 400, "order": [[ 2, "asc" ]], "bInfo": false, "bAutoWidth": false});'>Sort By Distance</button>            
            </div><br />
            <div id="datatable">
            <table id="example" class="table table-hover" data-click-to-select="true">
                <thead>
                <tr id="check-row">
                        <th class="span1"></th>
                        <th class="span1">Name</th>
                        <th class="span1">Distance (m)</th>
                        <th class="span1">Info</th>
                    </tr>
                </thead>
                <tbody>
                {% for artinstallation in artinstallations %}
                    <tr id="check-row" class="{{artinstallation.locationid}}">
                        <td><center><input type="checkbox" id="select" data-installation-name="{{ artinstallation.name }}" /></center></td>
                        <td>{{ artinstallation.name }}</td>
                        <td class="distance-{{artinstallation.locationid}}"></td>
                        <td><a href="{{ artinstallation.url }}" target="_blank" id="no-check"> â†’ </a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            </div>
            </div>
            {% else %}
                <strong>There are no installations to present.</strong>
            {% endif %}

            <!--
            <script>
                $("#example").DataTable( {"paging": false, "scrollY": 400, "order": [[ 2, "asc" ]]} );
            </script>
            -->

        </div>

        <div class="container">
            <!-- for testing purposes-->
            <div id="selection">
                <span id="installation_name"></span><i> was clicked</i>
            </div>

    </body>

</html>

<!-- See http://bootstrap-table.wenzhixin.net.cn/examples/
Search for checkbox select -->